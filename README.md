# GeoCLIP FastAPI Service

ÐšÐ¾Ð¼Ð¿Ð»ÐµÐºÑÐ½Ñ‹Ð¹ AI-ÑÐµÑ€Ð²Ð¸Ñ Ð´Ð»Ñ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ Ð³ÐµÐ¾Ð»Ð¾ÐºÐ°Ñ†Ð¸Ð¸ Ð¿Ð¾ Ñ„Ð¾Ñ‚Ð¾Ð³Ñ€Ð°Ñ„Ð¸Ð¸ Ð¸ Ð¿Ð¾Ð¸ÑÐºÐ° Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐ¸Ñ… Ð´Ð¾ÑÑ‚Ð¾Ð¿Ñ€Ð¸Ð¼ÐµÑ‡Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÐµÐ¹ Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ Ð¼ÑƒÐ»ÑŒÑ‚Ð¸Ð¼Ð¾Ð´ÐµÐ»Ð¸ GeoCLIP.  

ÐŸÑ€Ð¾ÐµÐºÑ‚ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½ Ð² Ñ€Ð°Ð¼ÐºÐ°Ñ… Ð½Ð°ÑƒÑ‡Ð½Ð¾Ð³Ð¾ Ñ‚Ñ€ÐµÐºÐ° ÐºÑƒÑ€ÑÐ° **"GenAI / AI-Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ñ‹"** Ð¸ Ð²ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚:  
- Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ñ€Ð°Ð±Ð¾Ñ‡Ð¸Ð¹ Ð¿Ñ€Ð¾Ñ‚Ð¾Ñ‚Ð¸Ð¿ (MVP),
- Ð²ÐµÐ±-Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ Ð½Ð° Streamlit,
- API Ð½Ð° FastAPI,
- Ð¾Ñ‚Ñ‡Ñ‘Ñ‚ Ð¿Ð¾ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ðµ Ð¸ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ð¾Ð¼Ñƒ Ð´Ð¸Ð·Ð°Ð¹Ð½Ñƒ,
- Ð´ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð°Ñ†Ð¸ÑŽ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸ (Ð²Ð¸Ð´ÐµÐ¾),
- ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¸Ð·Ð°Ñ†Ð¸ÑŽ (Docker Compose).

---

## ðŸŽ¯ Ð¦ÐµÐ»ÑŒ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°

Ð¡ÐµÑ€Ð²Ð¸Ñ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚:
- ðŸ” ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ð³ÐµÐ¾Ð³Ñ€Ð°Ñ„Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ñ‹ Ð¼ÐµÑÑ‚Ð° Ð¿Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð½Ð¾Ð¼Ñƒ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸ÑŽ.
- ðŸ“ ÐÐ°Ð¹Ñ‚Ð¸ Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐ¸Ðµ Ð´Ð¾ÑÑ‚Ð¾Ð¿Ñ€Ð¸Ð¼ÐµÑ‡Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸ Ð² Ð·Ð°Ð´Ð°Ð½Ð½Ð¾Ð¼ Ñ€Ð°Ð´Ð¸ÑƒÑÐµ Ð¸Ð· Ð±Ð°Ð·Ñ‹ (23+ Ñ‚Ð¾Ñ‡ÐµÐº).
- ðŸŒ Ð˜Ð·ÑƒÑ‡Ð°Ñ‚ÑŒ Ð¼ÐµÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ Ð¿Ð¾ ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ð°Ð¼ Ð¸ Ð¸ÑÐºÐ°Ñ‚ÑŒ Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹ Ñ€ÑÐ´Ð¾Ð¼.
- ðŸ–¥ Ð Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ñ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð°Ð¼Ð¸ Ð² ÑƒÐ´Ð¾Ð±Ð½Ð¾Ð¼ Ð²Ð¸Ð·ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐµ Ñ ÐºÐ°Ñ€Ñ‚Ð¾Ð¹ Ð¸ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸ÑÐ¼Ð¸.

### Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ:
- Ð¢ÑƒÑ€Ð¸ÑÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ: "Ð£Ð·Ð½Ð°Ð¹, Ð³Ð´Ðµ ÑÑ‚Ð¾ Ñ„Ð¾Ñ‚Ð¾ ÑÐ´ÐµÐ»Ð°Ð½Ð¾".
- Ð“ÐµÐ¾-Ð°Ð½Ð½Ð¾Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ñ… ÑÐ½Ð¸Ð¼ÐºÐ¾Ð² Ð´Ð»Ñ Ð±Ð»Ð¾Ð³Ð¾Ð² Ð¸ Ð¼ÐµÐ´Ð¸Ð°.
- ÐžÐ±Ñ€Ð°Ð·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ ÐºÐµÐ¹ÑÑ‹: Ð´ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚ÐµÐ¹ Ð¼ÑƒÐ»ÑŒÑ‚Ð¸Ð¼Ð¾Ð´Ð°Ð»ÑŒÐ½Ñ‹Ñ… Ð¼Ð¾Ð´ÐµÐ»ÐµÐ¹.

---

## ðŸ§  Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼Ð°Ñ Ð¼Ð¾Ð´ÐµÐ»ÑŒ

Ð’ Ð¾ÑÐ½Ð¾Ð²Ðµ Ð»ÐµÐ¶Ð¸Ñ‚ **GeoCLIP** â€” Ð¼ÑƒÐ»ÑŒÑ‚Ð¸Ð¼Ð¾Ð´Ð°Ð»ÑŒÐ½Ð°Ñ Ð¼Ð¾Ð´ÐµÐ»ÑŒ, Ð´Ð¾Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð½Ð°Ñ Ð½Ð° Ð¿Ð°Ñ€Ð°Ñ… `{Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ, GPS}` Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ñ‹ CLIP.  
ÐœÐ¾Ð´ÐµÐ»ÑŒ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚:
- ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ñ‹ Ð¼ÐµÑÑ‚Ð½Ð¾ÑÑ‚Ð¸,
- Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚Ð½Ñ‹Ðµ Ð¾Ñ†ÐµÐ½ÐºÐ¸,
- ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð° Ñ Ð·Ð°Ð´Ð°Ñ‡ÐµÐ¹ Ð¿Ð¾Ð¸ÑÐºÐ° Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐ¸Ñ… Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð².

---

## ðŸ—‚ Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°

```text
.
â”œâ”€â”€ app/                   # ÐšÐ¾Ð´ FastAPI + Streamlit
â”œâ”€â”€ docker/                # SQL init
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ screenshots/           # ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð¸Ð· UI
â”œâ”€â”€ report/                # ÐžÑ‚Ñ‡Ñ‘Ñ‚ Ð¿Ð¾ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ðµ Ð¸ Ð´Ð¸Ð·Ð°Ð¹Ð½Ñƒ
â”‚   â””â”€â”€ report.pdf
â”œâ”€â”€ demo/                  # Ð¡ÐºÑ€Ð¸Ð½ÐºÐ°ÑÑ‚ MVP
â”‚   â””â”€â”€ demo.mp4
â”œâ”€â”€ README.md
â””â”€â”€ .env.example           # ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº PostgreSQL
````

---

## ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº Ñ‡ÐµÑ€ÐµÐ· Docker Compose

1. Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð» `.env`:

   ```dotenv
   POSTGRES_USER=geoclip_user
   POSTGRES_PASSWORD=secret_password
   POSTGRES_DB=geoclip_db
   ```

2. ÐŸÐ¾Ð´Ð½Ð¸Ð¼Ð¸Ñ‚Ðµ ÑÐµÑ€Ð²Ð¸ÑÑ‹:

   ```bash
   docker-compose up --build -d
   ```

3. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð² Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ðµ:

   * ðŸŒ API: [http://localhost:8000](http://localhost:8000)
   * ðŸ“˜ Swagger UI: [http://localhost:8000/docs](http://localhost:8000/docs)
   * ðŸŽ› Frontend: [http://localhost:8501](http://localhost:8501)

4. ÐžÑ‡Ð¸ÑÑ‚ÐºÐ°:

   ```bash
   docker-compose down --rmi all -v
   ```

---

## ðŸ“‘ API-ÑÐ½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚Ñ‹

### `POST /predict/coords`

ÐŸÑ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚ Ð¿Ð¾ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸ÑŽ
**Query:** `top_k` (int)
**Body:** `file` (jpg/png)
**Response:**

```json
{
  "predictions": [
    { "lat": 48.8584, "lon": 2.2945, "prob": 0.85 }
  ]
}
```

### `POST /search/nearby`

ÐŸÐ¾Ð¸ÑÐº Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐ¸Ñ… Ð´Ð¾ÑÑ‚Ð¾Ð¿Ñ€Ð¸Ð¼ÐµÑ‡Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÐµÐ¹
**Query:** `radius_km` (float)
**Body:** `file` (jpg/png)
**Response:**

```json
{
  "center": { "lat": ..., "lon": ... },
  "matches": [
    {
      "id": "...",
      "name": "Eiffel Tower",
      "lat": ..., "lon": ..., "url": "...",
      "distance_km": 0.0
    }
  ]
}
```

### `GET /examples/nearby`

ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ð°Ð¼
**Query:** `lat`, `lon`, `radius_km`
**Response:** Ð°Ð½Ð°Ð»Ð¾Ð³Ð¸Ñ‡Ð½Ð¾ `/search/nearby`

### `GET /health`

ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð°Ñ‚ÑƒÑÐ° ÑÐµÑ€Ð²Ð¸ÑÐ°
**Response:**

```json
{ "status": "ok" }
```

---

## ðŸ–¥ Ð’ÐµÐ±-Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ (Streamlit + Folium)

Ð”Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð½Ð° [http://localhost:8501](http://localhost:8501)

### Ð ÐµÐ¶Ð¸Ð¼Ñ‹:

#### 1. Predict Coords

* Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ Ñ„Ð¾Ñ‚Ð¾
* ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ ÐºÐ°Ñ€Ñ‚Ñƒ Ñ Ð¼ÐµÑ‚ÐºÐ°Ð¼Ð¸
* Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚ Ð¸ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÐµÐ¹
  ![Predict](./screenshots/predict_coords.png)

#### 2. Search Nearby

* ÐÐ°Ñ…Ð¾Ð´Ð¸Ð¼ Ð´Ð¾ÑÑ‚Ð¾Ð¿Ñ€Ð¸Ð¼ÐµÑ‡Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸ Ñ€ÑÐ´Ð¾Ð¼
* ÐœÐ°Ñ€ÐºÐµÑ€Ñ‹ Ñ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸ÑÐ¼Ð¸ Ð¿Ñ€Ð¸ Ð½Ð°Ð²ÐµÐ´ÐµÐ½Ð¸Ð¸
  ![Search 1](./screenshots/search_nearby1.png)
  ![Search 2](./screenshots/search_nearby2.png)

#### 3. Examples Nearby

* Ð ÑƒÑ‡Ð½Ð¾Ð¹ Ð²Ð²Ð¾Ð´ ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚
* ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð¿Ð¾Ñ…Ð¾Ð¶Ð¸Ðµ Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹
  ![Examples](./screenshots/examples_nearby1.png)

---

## ðŸ“„ ÐÑ€Ñ‚ÐµÑ„Ð°ÐºÑ‚Ñ‹ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°

| Ð’Ð¸Ð´                   | Ð¤Ð°Ð¹Ð» / ÑÑÑ‹Ð»ÐºÐ°                              |
| --------------------- | ------------------------------------------ |
| ðŸ“˜ ÐÐ°ÑƒÑ‡Ð½Ñ‹Ð¹ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚      | [`report/report.pdf`](./report/report.pdf) |
| ðŸŽ¥ MVP-Ð´ÐµÐ¼Ð¾           | [`demo/demo.mp4`](./demo/demo.mp4)         |

---

## ðŸ“¦ Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸

```txt
torch
geoclip
fastapi
uvicorn[standard]
SQLAlchemy>=1.4
psycopg2-binary
streamlit
folium
streamlit-folium
pandas
requests
Pillow
```

---
